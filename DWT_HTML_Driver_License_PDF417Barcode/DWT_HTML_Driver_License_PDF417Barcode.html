<!DOCTYPE html>
<html>
<head>
    <title>Use Dynamic Web TWAIN to Read Barcode</title>
    <style>
        #mainWindow {
            width: 600px;
            margin: 0px auto;
            padding: 15px;
            background-color: #eee;
        }

        #fields input {
            float: right;
        }
    </style>
    <script type="text/javascript" src="Resources/dynamsoft.webtwain.initiate.js"> </script>
    <script type="text/javascript" src="Resources/dynamsoft.webtwain.config.js"> </script>
    <script type="text/javascript" src="Resources/addon/dynamsoft.webtwain.addon.barcode.js"> </script>
</head>
<body>
    <div id="mainWindow">
        <h1> Dynamic Web TWAIN - Driver's License</h1>
        <input type="button" value="Scan" onclick="AcquireImage();" />
        <input type="button" value="Load" onclick="LoadImage();" />
        <input type="button" value="Read Driver License" onclick="ReadBarcode();" /> <br />
        <!-- dwtcontrolContainer is the default div id for Dynamic Web TWAIN control.
         If you need to rename the id, you should also change the id in the dynamsoft.webtwain.config.js accordingly. -->
        <div id="dwtcontrolContainer" style="float:left; width:300px;"></div>
        <div id="fields" style="min-height:400px;">
            <p><input type="text" id="FirstName" />First Name: </p>
            <p><input type="text" id="LastName" />Last Name: </p>
            <p><input type="text" id="LicenseorIDNumber" />License Number: </p>
            <p><input type="text" id="MailingStreetAddress1" />Address 1: </p>
            <p><input type="text" id="MailingStreetAddress2" />Address 2: </p>
            <p><input type="text" id="MailingPostalCode" />Zip: </p>
            <p><input type="text" id="MailingCity" />City: </p>
            <p><input type="text" id="MailingJurisdictionCode" />State: </p>
        </div>

        <script type="text/javascript">
            Dynamsoft.WebTwainEnv.RegisterEvent('OnWebTwainReady', Dynamsoft_OnReady); // Register OnWebTwainReady event. This event fires as soon as Dynamic Web TWAIN is initialized and ready to be used

            var DWObject, strHTTPServer, CurrentPath;
            var Barcode_text;
            var driverLicenseFields = [];
            //Callback functions for async APIs
            function OnSuccess() {
                console.log('successful');
            }

            function OnFailure(errorCode, errorString) {
                alert(errorString);
            }

            function Dynamsoft_OnReady() {
                strHTTPServer = location.hostname;
                var CurrentPathName = unescape(location.pathname);
                CurrentPath = CurrentPathName.substring(0, CurrentPathName.lastIndexOf("/") + 1);
                DWObject = Dynamsoft.WebTwainEnv.GetWebTwain('dwtcontrolContainer'); // Get the Dynamic Web TWAIN object that is embeded in the div with id 'dwtcontrolContainer'
                var barcodeFilePath = location.href.substring(0, location.href.lastIndexOf("/") + 1) + "Resources/addon/Barcode.zip";
                DWObject.Addon.Barcode.Download(barcodeFilePath, OnSuccess, OnFailure);
                DWObject.IfSSL = false; // Set whether SSL is used
                DWObject.HTTPPort = location.port == "" ? 80 : location.port;
                DWObject.HTTPDownload(location.hostname, CurrentPath + "SampleDriverImage.jpg");
                driverLicenseFields = [
                    { 'abbreviation': 'DAA', 'description': 'FullName' }
                    , { 'abbreviation': 'DAB', 'description': 'LastName' }
                    , { 'abbreviation': 'DAB', 'description': 'FamilyName' }
                    , { 'abbreviation': 'DAC', 'description': 'FirstName' }
                    , { 'abbreviation': 'DAC', 'description': 'GivenName' }
                    , { 'abbreviation': 'DAD', 'description': 'MiddleNameorInitial' }
                    , { 'abbreviation': 'DAD', 'description': 'MiddleName' }
                    , { 'abbreviation': 'DAE', 'description': 'NameSuffix' }
                    , { 'abbreviation': 'DAF', 'description': 'NamePrefix' }
                    , { 'abbreviation': 'DAG', 'description': 'MailingStreetAddress1' }
                    , { 'abbreviation': 'DAH', 'description': 'MailingStreetAddress2' }
                    , { 'abbreviation': 'DAI', 'description': 'MailingCity' }
                    , { 'abbreviation': 'DAJ', 'description': 'MailingJurisdictionCode' }
                    , { 'abbreviation': 'DAK', 'description': 'MailingPostalCode' }
                    , { 'abbreviation': 'DAL', 'description': 'ResidenceStreetAddress1' }
                    , { 'abbreviation': 'DAM', 'description': 'ResidenceStreetAddress2' }
                    , { 'abbreviation': 'DAN', 'description': 'ResidenceCity' }
                    , { 'abbreviation': 'DAO', 'description': 'ResidenceJurisdictionCode' }
                    , { 'abbreviation': 'DAP', 'description': 'ResidencePostalCode' }
                    , { 'abbreviation': 'DAQ', 'description': 'LicenseorIDNumber' }
                    , { 'abbreviation': 'DAR', 'description': 'LicenseClassificationCode' }
                    , { 'abbreviation': 'DAS', 'description': 'LicenseRestrictionCode' }
                    , { 'abbreviation': 'DAT', 'description': 'LicenseEndorsementsCode' }
                    , { 'abbreviation': 'DAU', 'description': 'HeightinFT_IN' }
                    , { 'abbreviation': 'DAV', 'description': 'HeightinCM' }
                    , { 'abbreviation': 'DAW', 'description': 'WeightinLBS' }
                    , { 'abbreviation': 'DAX', 'description': 'WeightinKG' }
                    , { 'abbreviation': 'DAY', 'description': 'EyeColor' }
                    , { 'abbreviation': 'DAZ', 'description': 'HairColor' }
                    , { 'abbreviation': 'DBA', 'description': 'LicenseExpirationDate' }
                    , { 'abbreviation': 'DBB', 'description': 'DateofBirth' }
                    , { 'abbreviation': 'DBC', 'description': 'Sex' }
                    , { 'abbreviation': 'DBD', 'description': 'LicenseorIDDocumentIssueDate' }
                    , { 'abbreviation': 'DBE', 'description': 'IssueTimestamp' }
                    , { 'abbreviation': 'DBF', 'description': 'NumberofDuplicates' }
                    , { 'abbreviation': 'DBG', 'description': 'MedicalIndicatorCodes' }
                    , { 'abbreviation': 'DBH', 'description': 'OrganDonor' }
                    , { 'abbreviation': 'DBI', 'description': 'Non-ResidentIndicator' }
                    , { 'abbreviation': 'DBJ', 'description': 'UniqueCustomerIdentifier' }
                    , { 'abbreviation': 'DBK', 'description': 'SocialSecurityNumber' }
                    , { 'abbreviation': 'DBL', 'description': 'DateOfBirth' }
                    , { 'abbreviation': 'DBM', 'description': 'SocialSecurityNumber' }
                    , { 'abbreviation': 'DBN', 'description': 'FullName' }
                    , { 'abbreviation': 'DBO', 'description': 'LastName' }
                    , { 'abbreviation': 'DBO', 'description': 'FamilyName' }
                    , { 'abbreviation': 'DBP', 'description': 'FirstName' }
                    , { 'abbreviation': 'DBP', 'description': 'GivenName' }
                    , { 'abbreviation': 'DBQ', 'description': 'MiddleName' }
                    , { 'abbreviation': 'DBQ', 'description': 'MiddleNameorInitial' }
                    , { 'abbreviation': 'DBR', 'description': 'Suffix' }
                    , { 'abbreviation': 'DBS', 'description': 'Prefix' }
                    , { 'abbreviation': 'DCA', 'description': 'VirginiaSpecificClass' }
                    , { 'abbreviation': 'DCB', 'description': 'VirginiaSpecificRestrictions' }
                    , { 'abbreviation': 'DCD', 'description': 'VirginiaSpecificEndorsements' }
                    , { 'abbreviation': 'DCE', 'description': 'PhysicalDescriptionWeightRange' }
                    , { 'abbreviation': 'DCF', 'description': 'DocumentDiscriminator' }
                    , { 'abbreviation': 'DCG', 'description': 'Countryterritoryofissuance' }
                    , { 'abbreviation': 'DCH', 'description': 'FederalCommercialVehicleCodes' }
                    , { 'abbreviation': 'DCI', 'description': 'Placeofbirth' }
                    , { 'abbreviation': 'DCJ', 'description': 'Auditinformation' }
                    , { 'abbreviation': 'DCK', 'description': 'InventoryControlNumber' }
                    , { 'abbreviation': 'DCL', 'description': 'RaceEthnicity' }
                    , { 'abbreviation': 'DCM', 'description': 'Standardvehicleclassification' }
                    , { 'abbreviation': 'DCN', 'description': 'Standardendorsementcode' }
                    , { 'abbreviation': 'DCO', 'description': 'Standardrestrictioncode' }
                    , { 'abbreviation': 'DCP', 'description': 'Jurisdictionspecificvehicleclassificationdescription' }
                    , { 'abbreviation': 'DCQ', 'description': 'Jurisdiction-specific' }
                    , { 'abbreviation': 'DCR', 'description': 'Jurisdictionspecificrestrictioncodedescription' }
                    , { 'abbreviation': 'DCS', 'description': 'FamilyName' }
                    , { 'abbreviation': 'DCS', 'description': 'LastName' }
                    , { 'abbreviation': 'DCT', 'description': 'GivenName' }
                    , { 'abbreviation': 'DCT', 'description': 'FirstName' }
                    , { 'abbreviation': 'DCU', 'description': 'Suffix' }
                    , { 'abbreviation': 'DDA', 'description': 'ComplianceType' }
                    , { 'abbreviation': 'DDB', 'description': 'CardRevisionDate' }
                    , { 'abbreviation': 'DDC', 'description': 'HazMatEndorsementExpiryDate' }
                    , { 'abbreviation': 'DDD', 'description': 'LimitedDurationDocumentIndicator' }
                    , { 'abbreviation': 'DDE', 'description': 'FamilyNameTruncation' }
                    , { 'abbreviation': 'DDF', 'description': 'FirstNamesTruncation' }
                    , { 'abbreviation': 'DDG', 'description': 'MiddleNamesTruncation' }
                    , { 'abbreviation': 'DDH', 'description': 'Under18Until' }
                    , { 'abbreviation': 'DDI', 'description': 'Under19Until' }
                    , { 'abbreviation': 'DDJ', 'description': 'Under21Until' }
                    , { 'abbreviation': 'DDK', 'description': 'OrganDonorIndicator' }
                    , { 'abbreviation': 'DDL', 'description': 'VeteranIndicator' }
                    , { 'abbreviation': 'PAA', 'description': 'PermitClassificationCode' }
                    , { 'abbreviation': 'PAB', 'description': 'PermitExpirationDate' }
                    , { 'abbreviation': 'PAC', 'description': 'PermitIdentifier' }
                    , { 'abbreviation': 'PAD', 'description': 'PermitIssueDate' }
                    , { 'abbreviation': 'PAE', 'description': 'PermitRestrictionCode' }
                    , { 'abbreviation': 'PAF', 'description': 'PermitEndorsementCode' }
                    , { 'abbreviation': 'ZVA', 'description': 'CourtRestrictionCode' }
                ]
            }

            function AcquireImage() {
                if (DWObject) {
                    DWObject.SelectSource();
                    DWObject.OpenSource();
                    DWObject.IfDisableSourceAfterAcquire = true;	// Scanner source will be disabled/closed automatically after the scan.
                    DWObject.AcquireImage(OnSuccess, OnFailure);
                }
            }

            function LoadImage() {
                if (DWObject) {
                    DWObject.IfShowFileDialog = true; // Open the system's file dialog to load image
                    DWObject.LoadImageEx("", EnumDWT_ImageType.IT_ALL, OnSuccess, OnFailure); // Load images in all supported formats (.bmp, .jpg, .tif, .png, .pdf). OnSuccess or OnFailure will be called after the operation
                }
            }

            function GetField(keyword) {
                console.log(keyword);
                var k = Barcode_text.search(keyword);
                if (k == -1)
                    return false;
                var m = Barcode_text.indexOf("\n", k);
                var subtext = Barcode_text.substring(k + 3, m);
                console.log(subtext);
                return subtext;
            }

            function GetBarcodeInfo(sImageIndex, result) {//This is the function called when barcode is read successfully
                //Retrieve barcode details
                var count = result.GetCount();
                if (count == 0) {
                    alert("The barcode for the selected format is not found.");
                    return;
                } else {
                    for (i = 0; i < count; i++) {
                        Barcode_text = result.GetContent(i);
                        var x = result.GetX1(i);
                        var y = result.GetY1(i);
                        var format = result.GetFormat(i);
                        var barcodeText = ("barcode[" + (i + 1) + "]: " + "\n" + Barcode_text + "\n");
                        extractInformation(Barcode_text);
                    }
                }
            }
            function extractInformation(_text) {
                for (var i = 0; i < driverLicenseFields.length; i++) {
                    var __item = driverLicenseFields[i];
                    console.log(__item.description);
                    var _fieldValue = GetField(__item.abbreviation);
                    if (_fieldValue && document.getElementById(__item.description)) {
                        document.getElementById(__item.description).value = _fieldValue;
                    }
                }
            }

            function ReadBarcode() {
                if (DWObject) {
                    if (DWObject.HowManyImagesInBuffer == 0) {
                        alert("Please scan or load an image first.");
                        return;
                    }
                    else {
                        result = DWObject.Addon.Barcode.Read(
                            DWObject.CurrentImageIndexInBuffer, 1024, GetBarcodeInfo, OnFailure);
                    }
                }
            }
        </script>
    </div>
</body>
</html>
